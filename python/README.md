# AMD GPU æ•¸æ“šæ”¶é›†å·¥å…· - Python ç‰ˆæœ¬

é€™æ˜¯åŸæœ¬ `scripts/daily_gpu_log.sh` çš„ Python é‡å¯«ç‰ˆæœ¬ï¼Œæä¾›ç›¸åŒçš„åŠŸèƒ½ä½†ä½¿ç”¨ Python å¯¦ç¾ï¼Œå…·æœ‰æ›´å¥½çš„éŒ¯èª¤è™•ç†ã€æ•¸æ“šè™•ç†èƒ½åŠ›å’Œå¯æ“´å±•æ€§ã€‚

## ğŸš€ åŠŸèƒ½ç‰¹è‰²

### å®Œå…¨ç›¸å®¹
- **è¼¸å‡ºæ ¼å¼ç›¸å®¹**: ç”Ÿæˆèˆ‡åŸ shell è…³æœ¬ç›¸åŒçš„ CSV å’Œå ±å‘Šæ ¼å¼
- **ç›®éŒ„çµæ§‹ç›¸å®¹**: ä½¿ç”¨ç›¸åŒçš„æ•¸æ“šç›®éŒ„çµæ§‹
- **åŠŸèƒ½å°ç­‰**: æä¾›æ‰€æœ‰åŸè…³æœ¬çš„åŠŸèƒ½

### Python å„ªå‹¢  
- **æ›´å¥½çš„éŒ¯èª¤è™•ç†**: è©³ç´°çš„ç•°å¸¸è™•ç†å’ŒéŒ¯èª¤è¨Šæ¯
- **æ•¸æ“šè™•ç†èƒ½åŠ›**: ä½¿ç”¨ pandas é€²è¡Œé«˜æ•ˆçš„æ•¸æ“šæ“ä½œ
- **HTTP è«‹æ±‚**: ä½¿ç”¨ requests åº«æä¾›ç©©å®šçš„ç¶²è·¯è«‹æ±‚
- **æ¨¡çµ„åŒ–è¨­è¨ˆ**: é¢å‘å°è±¡çš„ç¨‹å¼è¨­è¨ˆï¼Œæ˜“æ–¼ç¶­è­·å’Œæ“´å±•

## ğŸ“‹ éœ€æ±‚

### Python ç’°å¢ƒ
- Python 3.7+
- requests >= 2.25.0  
- pandas >= 1.3.0

### ç³»çµ±éœ€æ±‚
- ç¶²è·¯é€£ç·šåˆ°å„ GPU ç¯€é» (192.168.10.103-106)
- å„ç¯€é» Netdata æœå‹™é‹è¡Œåœ¨ç«¯å£ 19999

## ğŸ› ï¸ å®‰è£

### 1. å®‰è£ Python ä¾è³´

```bash
# åˆ‡æ›åˆ° python ç›®éŒ„
cd /path/to/data_collection/python

# å®‰è£ä¾è³´å¥—ä»¶
pip3 install -r requirements.txt

# æˆ–è€…ä½¿ç”¨è™›æ“¬ç’°å¢ƒ
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

### 2. è¨­å®šåŸ·è¡Œæ¬Šé™

```bash
chmod +x run_daily_gpu_log.sh
```

## ğŸ“– ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

```bash
# æ”¶é›†ä»Šå¤©çš„æ•¸æ“š
./python/run_daily_gpu_log.sh

# æ”¶é›†æŒ‡å®šæ—¥æœŸçš„æ•¸æ“š  
./python/run_daily_gpu_log.sh 2025-08-01

# é¡¯ç¤ºèªªæ˜
./python/run_daily_gpu_log.sh --help
```

### ç›´æ¥ä½¿ç”¨ Python è…³æœ¬

```bash
# æ”¶é›†ä»Šå¤©çš„æ•¸æ“š
python3 python/daily_gpu_log.py

# æ”¶é›†æŒ‡å®šæ—¥æœŸçš„æ•¸æ“š
python3 python/daily_gpu_log.py 2025-08-01

# è‡ªè¨‚æ•¸æ“šç›®éŒ„
python3 python/daily_gpu_log.py --data-dir /custom/path

# é¡¯ç¤ºå®Œæ•´èªªæ˜
python3 python/daily_gpu_log.py --help
```

## ğŸ“Š è¼¸å‡ºæ ¼å¼

### æ•¸æ“šçµæ§‹

è¼¸å‡ºçš„æ•¸æ“šçµæ§‹èˆ‡åŸ shell è…³æœ¬å®Œå…¨ç›¸åŒï¼š

```
data/
â”œâ”€â”€ colab-gpu1/
â”‚   â””â”€â”€ 2025-08-01/
â”‚       â”œâ”€â”€ gpu1_2025-08-01.csv      # å„ GPU çš„è©³ç´°æ•¸æ“š
â”‚       â”œâ”€â”€ gpu9_2025-08-01.csv      # ...
â”‚       â”œâ”€â”€ ...
â”‚       â”œâ”€â”€ average_2025-08-01.csv   # å¹³å‡ä½¿ç”¨ç‡çµ±è¨ˆ
â”‚       â””â”€â”€ summary_2025-08-01.txt   # æ‘˜è¦å ±å‘Š
â”œâ”€â”€ colab-gpu2/
â”œâ”€â”€ colab-gpu3/
â””â”€â”€ colab-gpu4/
```

### CSV æª”æ¡ˆæ ¼å¼

æ¯å€‹ GPU çš„ CSV æª”æ¡ˆåŒ…å«ï¼š
```csv
æ™‚é–“æˆ³,æ—¥æœŸæ™‚é–“,GPUä½¿ç”¨ç‡(%),VRAMä½¿ç”¨ç‡(%)
1722470400,"2025-08-01 00:00:00",1.23,45.67
1722471000,"2025-08-01 00:10:00",2.45,47.89
...
```

### å¹³å‡å€¼ CSV æ ¼å¼

```csv
GPUå¡è™Ÿ,å¹³å‡GPUä½¿ç”¨ç‡(%),å¹³å‡VRAMä½¿ç”¨ç‡(%)
gpu1,12.34,56.78
gpu9,23.45,67.89
...
å…¨éƒ¨å¹³å‡,18.75,62.33
```

## ğŸ”§ æŠ€è¡“å¯¦ç¾

### é¡åˆ¥æ¶æ§‹

```python
class GPUDataCollector:
    """ä¸»è¦çš„æ•¸æ“šæ”¶é›†å™¨é¡åˆ¥"""
    
    def __init__(self, data_dir="./data"):
        # åˆå§‹åŒ–é…ç½®
    
    def collect_data(self, date_str=None):
        # ä¸»è¦æ”¶é›†æµç¨‹
    
    def fetch_netdata_data(self, host, chart, start, end):
        # å¾ Netdata API ç²å–æ•¸æ“š
    
    def process_gpu_data(self, ip, name, date, start, end):
        # è™•ç†å–®ä¸€ç¯€é»çš„æ•¸æ“š
    
    def calculate_averages(self, date_str):
        # è¨ˆç®—å¹³å‡å€¼å’Œç”Ÿæˆå ±å‘Š
```

### é—œéµç‰¹æ€§

1. **ç©©å®šçš„ç¶²è·¯è«‹æ±‚**: ä½¿ç”¨ requests åº«è™•ç† HTTP è«‹æ±‚ï¼ŒåŒ…å«è¶…æ™‚å’ŒéŒ¯èª¤è™•ç†
2. **é«˜æ•ˆæ•¸æ“šè™•ç†**: ä½¿ç”¨ pandas é€²è¡Œæ•¸æ“šæ“ä½œå’Œçµ±è¨ˆè¨ˆç®—
3. **æ™‚é–“æˆ³è™•ç†**: æ­£ç¢ºè™•ç† UTC æ™‚é–“æˆ³è½‰æ›
4. **éŒ¯èª¤æ¢å¾©**: å–®ä¸€ç¯€é»å¤±æ•—ä¸æœƒå½±éŸ¿å…¶ä»–ç¯€é»çš„æ•¸æ“šæ”¶é›†

## ğŸ†š èˆ‡åŸ Shell è…³æœ¬çš„æ¯”è¼ƒ

| ç‰¹æ€§ | Shell è…³æœ¬ | Python ç‰ˆæœ¬ |
|------|------------|--------------|
| åŸ·è¡Œé€Ÿåº¦ | è¼ƒå¿« | ç¨æ…¢ï¼ˆä½†å·®ç•°ä¸å¤§ï¼‰ |
| éŒ¯èª¤è™•ç† | åŸºæœ¬ | è©³ç´°ä¸”ç²¾ç¢º |
| æ•¸æ“šè™•ç† | åŸºæœ¬ï¼ˆawk/sedï¼‰ | å¼·å¤§ï¼ˆpandasï¼‰ |
| ç¶­è­·æ€§ | ä¸­ç­‰ | é«˜ |
| å¯æ“´å±•æ€§ | æœ‰é™ | å„ªç§€ |
| ä¾è³´ | ç³»çµ±å·¥å…· | Python å¥—ä»¶ |
| è¨˜æ†¶é«”ä½¿ç”¨ | ä½ | ä¸­ç­‰ |

## ğŸ› å¸¸è¦‹å•é¡Œ

### 1. ç¶²è·¯é€£ç·šå•é¡Œ
```
éŒ¯èª¤ï¼šç„¡æ³•å¾ http://192.168.10.103:19999 ç²å–æ•¸æ“š
```
**è§£æ±ºæ–¹æ¡ˆ**: æª¢æŸ¥ç¯€é»çš„ Netdata æœå‹™æ˜¯å¦é‹è¡Œï¼Œç¢ºèªç¶²è·¯é€£ç·š

### 2. Python å¥—ä»¶ç¼ºå¤±
```
ModuleNotFoundError: No module named 'requests'
```
**è§£æ±ºæ–¹æ¡ˆ**: åŸ·è¡Œ `pip3 install -r requirements.txt`

### 3. æ¬Šé™å•é¡Œ
```
Permission denied: ./run_daily_gpu_log.sh
```
**è§£æ±ºæ–¹æ¡ˆ**: åŸ·è¡Œ `chmod +x run_daily_gpu_log.sh`

### 4. æ•¸æ“šç›®éŒ„æ¬Šé™
```
PermissionError: [Errno 13] Permission denied: './data/colab-gpu1'
```
**è§£æ±ºæ–¹æ¡ˆ**: ç¢ºèªå°æ•¸æ“šç›®éŒ„æœ‰å¯«å…¥æ¬Šé™

## ğŸ”„ é·ç§»æŒ‡å—

å¾åŸ shell è…³æœ¬é·ç§»åˆ° Python ç‰ˆæœ¬ï¼š

1. **å®‰è£ä¾è³´**: `pip3 install -r python/requirements.txt`
2. **æ¸¬è©¦åŸ·è¡Œ**: `./python/run_daily_gpu_log.sh`
3. **é©—è­‰è¼¸å‡º**: ç¢ºèªç”Ÿæˆçš„æª”æ¡ˆæ ¼å¼æ­£ç¢º
4. **æ›´æ–° cron**: ä¿®æ”¹å®šæ™‚ä»»å‹™æŒ‡å‘æ–°çš„ Python è…³æœ¬

### æ›´æ–° crontab ç¯„ä¾‹

```bash
# åŸä¾†çš„è¨­å®š
45 23 * * * /bin/bash /path/to/data_collection/scripts/daily_gpu_log.sh

# æ–°çš„è¨­å®š
45 23 * * * /bin/bash /path/to/data_collection/python/run_daily_gpu_log.sh
```

## ğŸš€ æœªä¾†æ“´å±•

Python ç‰ˆæœ¬ç‚ºæœªä¾†åŠŸèƒ½æ“´å±•æä¾›äº†è‰¯å¥½çš„åŸºç¤ï¼š

- **ä¸¦è¡Œè™•ç†**: å¯ä½¿ç”¨å¤šåŸ·è¡Œç·’åŒæ™‚æ”¶é›†å¤šå€‹ç¯€é»çš„æ•¸æ“š
- **æ•¸æ“šé©—è­‰**: æ›´è¤‡é›œçš„æ•¸æ“šå“è³ªæª¢æŸ¥
- **é€šçŸ¥ç³»çµ±**: æ”¶é›†å¤±æ•—æ™‚çš„è‡ªå‹•é€šçŸ¥
- **é…ç½®æª”æ¡ˆ**: æ”¯æ´å¤–éƒ¨é…ç½®æª”æ¡ˆ
- **æ—¥èªŒç³»çµ±**: è©³ç´°çš„æ—¥èªŒè¨˜éŒ„å’Œåˆ†æ
- **æ•¸æ“šåº«æ”¯æ´**: ç›´æ¥å¯«å…¥æ•¸æ“šåº«è€Œéæª”æ¡ˆ

## ğŸ“ é–‹ç™¼å»ºè­°

åœ¨æ­¤ Python ç‰ˆæœ¬åŸºç¤ä¸Šé€²è¡Œé–‹ç™¼æ™‚ï¼Œå»ºè­°ï¼š

1. **ä¿æŒç›¸å®¹æ€§**: ç¢ºä¿è¼¸å‡ºæ ¼å¼èˆ‡ç¾æœ‰è¦–è¦ºåŒ–å·¥å…·ç›¸å®¹
2. **éŒ¯èª¤è™•ç†**: åŠ å¼·ç¶²è·¯ç•°å¸¸å’Œæ•¸æ“šç•°å¸¸çš„è™•ç†
3. **æ•ˆèƒ½å„ªåŒ–**: è€ƒæ…®ä½¿ç”¨ç•°æ­¥è«‹æ±‚æå‡æ”¶é›†é€Ÿåº¦
4. **æ¸¬è©¦è¦†è“‹**: ç‚ºé—œéµåŠŸèƒ½ç·¨å¯«å–®å…ƒæ¸¬è©¦
5. **æ–‡æª”æ›´æ–°**: ä¿æŒç¨‹å¼ç¢¼è¨»è§£å’Œä½¿ç”¨æ–‡æª”çš„åŒæ­¥æ›´æ–°
